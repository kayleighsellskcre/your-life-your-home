{% extends "lender/layout.html" %}

{% block lender_content %}
<style>
  .loans-container {
    max-width: 1600px;
    margin: 0 auto;
  }

  .loan-card {
    background: var(--white);
    border: 2px solid var(--taupe-beige);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
  }

  .loan-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--taupe-beige);
    transition: all 0.3s ease;
  }

  .loan-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
    border-color: var(--olive-green);
  }

  .loan-card:hover::before {
    background: var(--olive-green);
    width: 6px;
  }

  .loan-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
    gap: 1.5rem;
  }

  .loan-main-info {
    flex: 1;
    min-width: 0;
  }

  .loan-borrower {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--charcoal-brown);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .loan-type {
    font-size: 1rem;
    color: #666;
    margin-bottom: 0.75rem;
  }

  .loan-badges {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .status-badge {
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .status-badge.preapproval { background: var(--light-cream); color: var(--charcoal-brown); }
  .status-badge.processing { background: #FFF3CD; color: #856404; }
  .status-badge.underwriting { background: #D1ECF1; color: #0C5460; }
  .status-badge.clear_to_close { background: #D4EDDA; color: #155724; }
  .status-badge.closed { background: #CCE5FF; color: #004085; }

  .stage-badge {
    padding: 0.4rem 0.9rem;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: 600;
    background: var(--taupe-beige);
    color: var(--charcoal-brown);
  }

  .loan-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--taupe-beige);
  }

  .detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .detail-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #999;
    font-weight: 600;
  }

  .detail-value {
    font-size: 1rem;
    color: var(--charcoal-brown);
    font-weight: 500;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--light-cream);
    border-radius: var(--border-radius-lg);
    border: 2px dashed var(--taupe-beige);
  }

  .empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.6;
  }

  .empty-state h3 {
    color: var(--charcoal-brown);
    margin-bottom: 0.75rem;
  }

  .empty-state p {
    color: #666;
    max-width: 500px;
    margin: 0 auto;
  }
</style>

<div class="dashboard-main__header">
  <p class="dashboard-tagline">Pipeline management</p>
  <h1>Loan Processing Tracker</h1>
  <p>Give borrowers and partner agents a clear, up-to-date view of where each loan stands.</p>
</div>

<div class="loans-container">
  <!-- Add Loan Form -->
  <div class="card" style="margin-bottom: 3rem;">
    <h2>Add a Loan</h2>
    <form method="post" style="display:grid;gap:1rem;max-width:640px;margin-top:1.5rem;">
      <div>
        <label for="borrower_name" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Borrower Name</label>
        <input id="borrower_name" name="borrower_name" required />
      </div>
      <div>
        <label for="status" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Status</label>
        <select id="status" name="status">
          <option value="preapproval">Pre-Approval</option>
          <option value="processing">Processing</option>
          <option value="underwriting">Underwriting</option>
          <option value="clear_to_close">Clear to Close</option>
          <option value="closed">Closed</option>
        </select>
      </div>
      <div>
        <label for="loan_type" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Loan Type</label>
        <input id="loan_type" name="loan_type" placeholder="Conventional, FHA, VA, USDA..." />
      </div>
      <div>
        <label for="target_payment" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Target Payment</label>
        <input id="target_payment" name="target_payment" placeholder="Example: $2,000/mo" />
      </div>
      <div>
        <label for="stage" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Stage</label>
        <select id="stage" name="stage">
          <option value="preapproval_started">Pre-Approval Started</option>
          <option value="preapproval_verified">Pre-Approval Verified</option>
          <option value="loan_processing">Loan Processing</option>
          <option value="appraisal_ordered">Appraisal Ordered</option>
          <option value="appraisal_received">Appraisal Received</option>
          <option value="uw_approval">Underwriting Approval</option>
          <option value="clear_to_close">Clear to Close</option>
          <option value="funding_closing">Funding and Closing</option>
        </select>
      </div>
      <div>
        <label for="close_date" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Target Close Date</label>
        <input type="date" id="close_date" name="close_date" />
      </div>
      <button class="btn btn-primary" type="submit">Save Loan</button>
    </form>
  </div>

  <!-- Loans List -->
  {% if loans %}
    <h2 style="margin-bottom: 1.5rem; font-family: var(--font-heading); color: var(--charcoal-brown);">Your Pipeline</h2>
    
    {% for loan in loans %}
      <div class="loan-card">
        <div class="loan-header">
          <div class="loan-main-info">
            <div class="loan-borrower">
              <span>ðŸ‘¤</span>
              <span>{{ loan.borrower_name }}</span>
            </div>
            <div class="loan-type">
              <strong>Loan Type:</strong> {{ loan.loan_type or 'Not specified' }}
            </div>
            <div class="loan-badges">
              <span class="status-badge {{ loan.status or 'preapproval' }}">
                {{ (loan.status or 'preapproval')|replace('_',' ')|title }}
              </span>
              <span class="stage-badge">
                {{ (loan.stage or 'preapproval_started')|replace('_',' ')|title }}
              </span>
            </div>
          </div>
        </div>
        
        <div class="loan-details">
          <div class="detail-item">
            <span class="detail-label">Target Payment</span>
            <span class="detail-value">{{ loan.target_payment or 'Not set' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Close Date</span>
            <span class="detail-value">{{ loan.close_date or 'Not set' }}</span>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="empty-state">
      <div class="empty-state-icon">ðŸ“‹</div>
      <h3>No Loans Yet</h3>
      <p>Add one file you are working on so you can track its path here.</p>
    </div>
  {% endif %}
</div>

{% endblock %}
