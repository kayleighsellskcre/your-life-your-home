{% extends "base.html" %}

{% block page_title %}Dashboard • Your Life Your Home{% endblock %}

{% block content %}
<style>
  /* ===========================
     LUXURIOUS DASHBOARD NAVIGATION
     Professional • Uniform • Perfect Spacing
     =========================== */
  
  :root {
    --nav-height: 56px;
    --nav-font: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
  }
  
  /* NAVIGATION BAR */
  .ylh-horizontal-nav {
    background: linear-gradient(180deg, #f8f6f0 0%, #f5f1e8 100%);
    border-bottom: 1px solid rgba(107, 106, 69, 0.2);
    box-shadow: 0 2px 12px rgba(58, 53, 44, 0.06);
    position: sticky;
    top: 5rem;
    z-index: 999;
    width: 100%;
  }
  
  .ylh-nav-container {
    max-width: 1600px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 2rem;
    height: var(--nav-height);
    gap: 2rem;
  }
  
  /* DASHBOARD TITLE */
  .ylh-nav-title {
    font-family: 'Playfair Display', Georgia, serif;
    font-size: 1.25rem;
    color: #6B6A45;
    font-weight: 500;
    letter-spacing: 0.01em;
    margin: 0;
    white-space: nowrap;
    flex-shrink: 0;
  }
  
  /* NAVIGATION ITEMS CONTAINER */
  .ylh-nav-items {
    display: flex !important;
    align-items: center !important;
    gap: 0.25rem !important;
    flex: 1 !important;
    justify-content: center !important;
    opacity: 1 !important;
    visibility: visible !important;
  }
  
  .ylh-nav-items > * {
    opacity: 1 !important;
    visibility: visible !important;
    display: inline-flex !important;
  }
  
  /* NAVIGATION BUTTONS - UNIFORM STYLING */
  .ylh-nav-button {
    background: transparent !important;
    border: none !important;
    color: #6B6A45 !important;
    padding: 0.75rem 1.25rem !important;
    font-family: var(--nav-font) !important;
    font-size: 0.8125rem !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 0.075em !important;
    cursor: pointer !important;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
    white-space: nowrap !important;
    border-radius: 6px !important;
    text-decoration: none !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    min-height: auto !important;
  }
  
  .ylh-nav-button::after {
    content: '';
    position: absolute;
    bottom: 6px;
    left: 50%;
    width: 0;
    height: 2px;
    background: #6B6A45;
    transform: translateX(-50%);
    transition: width 0.3s ease;
  }
  
  .ylh-nav-button:hover {
    background: rgba(107, 106, 69, 0.08) !important;
    color: #3A352C !important;
  }
  
  .ylh-nav-button:hover::after {
    width: 70% !important;
  }
  
  .ylh-nav-button.active {
    background: rgba(107, 106, 69, 0.12) !important;
    color: #3A352C !important;
    font-weight: 700 !important;
  }
  
  .ylh-nav-button.active::after {
    width: 70% !important;
  }
  
  /* DROPDOWN CONTAINER */
  .ylh-dropdown {
    position: relative !important;
    display: inline-block !important;
    flex-shrink: 0 !important;
    opacity: 1 !important;
    visibility: visible !important;
  }
  
  /* DROPDOWN MENU */
  .ylh-dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    background: white;
    min-width: 240px;
    border-radius: 8px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    border: 1px solid rgba(107, 106, 69, 0.15);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    overflow: hidden;
  }
  
  .ylh-dropdown.is-open .ylh-dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }
  
  /* DROPDOWN ITEMS */
  .ylh-dropdown-item {
    display: block;
    padding: 0.875rem 1.25rem;
    color: #3A352C;
    text-decoration: none;
    font-family: var(--nav-font);
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
  }
  
  .ylh-dropdown-item:hover {
    background: #f6f2e8;
    border-left-color: #C8B497;
    padding-left: 1.5rem;
  }
  
  .ylh-dropdown-item.active {
    background: #efe9dc;
    color: #6B6A45;
    font-weight: 600;
    border-left-color: #6B6A45;
  }
  
  /* AGENT/LENDER INFO - RIGHT SIDE */
  .agent-info-widget {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
  }
  
  .agent-lender-card {
    display: flex;
    align-items: center;
    gap: 0.625rem;
    padding: 0.5rem 0.875rem;
    background: white;
    border: 1px solid rgba(107, 106, 69, 0.15);
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(58, 53, 44, 0.06);
    transition: all 0.2s ease;
  }
  
  .agent-lender-card:hover {
    box-shadow: 0 4px 12px rgba(58, 53, 44, 0.1);
  }
  
  .agent-lender-photo {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #C8B497;
    flex-shrink: 0;
  }
  
  .agent-lender-photo-placeholder {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #6B6A45;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.95rem;
    font-weight: 600;
    flex-shrink: 0;
  }
  
  .agent-lender-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    min-width: 0;
  }
  
  .agent-lender-label {
    font-size: 0.625rem;
    color: rgba(58, 53, 44, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.06em;
    font-weight: 600;
  }
  
  .agent-lender-name {
    font-size: 0.75rem;
    color: #3A352C;
    font-weight: 600;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 140px;
  }
  
  /* MOBILE RESPONSIVE */
  @media (max-width: 1200px) {
    .ylh-nav-container {
      gap: 1rem;
    }
    
    .ylh-nav-items {
      gap: 0.125rem;
    }
    
    .ylh-nav-button {
      padding: 0.625rem 0.875rem !important;
      font-size: 0.75rem !important;
    }
    
    .agent-info-widget {
      gap: 0.5rem;
    }
  }
  
  @media (max-width: 968px) {
    .ylh-nav-container {
      flex-wrap: wrap;
      height: auto;
      padding: 0.75rem 1.5rem;
      gap: 0.75rem;
    }
    
    .ylh-nav-title {
      font-size: 1.125rem;
      width: 100%;
      text-align: center;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(107, 106, 69, 0.15);
    }
    
    .ylh-nav-items {
      width: 100%;
      justify-content: center;
      flex-wrap: wrap;
      gap: 0.375rem;
    }
    
    .ylh-nav-button {
      padding: 0.625rem 1rem !important;
      font-size: 0.75rem !important;
    }
    
    .agent-info-widget {
      width: 100%;
      justify-content: center;
      padding-top: 0.5rem;
      border-top: 1px solid rgba(107, 106, 69, 0.15);
    }
    
    .ylh-dropdown-menu {
      position: fixed;
      top: auto;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      min-width: 100%;
      max-height: 60vh;
      border-radius: 16px 16px 0 0;
      transform: translateY(100%);
    }
    
    .ylh-dropdown.is-open .ylh-dropdown-menu {
      transform: translateY(0);
    }
  }
  
  @media (max-width: 640px) {
    .ylh-nav-container {
      padding: 0.625rem 1rem;
    }
    
    .ylh-nav-title {
      font-size: 1rem;
    }
    
    .ylh-nav-button {
      padding: 0.5rem 0.75rem !important;
      font-size: 0.7rem !important;
    }
    
    .agent-lender-card {
      padding: 0.375rem 0.625rem;
    }
    
    .agent-lender-photo,
    .agent-lender-photo-placeholder {
      width: 32px;
      height: 32px;
    }
    
    .agent-lender-name {
      font-size: 0.7rem;
      max-width: 100px;
    }
  }
</style>

<!-- Navigation Bar -->
<nav class="ylh-horizontal-nav">
  <div class="ylh-nav-container">
    <!-- Dashboard Title -->
    <h1 class="ylh-nav-title">Dashboard</h1>
    
    <!-- Navigation Items -->
    {% set path = request.path %}
    {% set is_home_base = path == '/homeowner' or path == '/homeowner/' %}
    {% set is_value = path.startswith('/homeowner/value') %}
    {% set is_reno = path.startswith('/homeowner/reno/') or path.startswith('/homeowner/saved-notes') or path.startswith('/homeowner/design-boards') %}
    {% set is_next = path.startswith('/homeowner/next/') %}
    {% set is_care = path.startswith('/homeowner/care/') or path.startswith('/homeowner/upload-documents') or path.startswith('/homeowner/home-timeline') %}
    {% set is_support = path.startswith('/homeowner/support/') %}
    
    <div class="ylh-nav-items">
      <a href="{{ url_for('homeowner_overview') }}" class="ylh-nav-button {% if is_home_base %}active{% endif %}">
        Home Base
      </a>
      
      <a href="{{ url_for('homeowner_value_equity_overview') }}" class="ylh-nav-button {% if is_value %}active{% endif %}">
        Value & Equity
      </a>
      
      <div class="ylh-dropdown">
        <button type="button" class="ylh-nav-button {% if is_reno %}active{% endif %}" onclick="toggleDropdown(this, event)">
          Renovation ▾
        </button>
        <div class="ylh-dropdown-menu">
          <a href="{{ url_for('homeowner_saved_notes') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/saved-notes') or path.startswith('/homeowner/design-boards') %}active{% endif %}">
            Mood Board & Planner
          </a>
          <a href="{{ url_for('homeowner_reno_material_cost') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/reno/material-cost') %}active{% endif %}">
            Cost Estimator
          </a>
          <a href="{{ url_for('homeowner_reno_roi_guide') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/reno/roi-guide') %}active{% endif %}">
            ROI Guide
          </a>
        </div>
      </div>
      
      <div class="ylh-dropdown">
        <button type="button" class="ylh-nav-button {% if is_next %}active{% endif %}" onclick="toggleDropdown(this, event)">
          Next Home ▾
        </button>
        <div class="ylh-dropdown-menu">
          <a href="{{ url_for('homeowner_next_plan_move') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/next/plan-my-move') %}active{% endif %}">
            Plan My Move
          </a>
          <a href="{{ url_for('homeowner_next_buy_sell_guidance') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/next/buy-sell-guidance') %}active{% endif %}">
            Buy & Sell Guidance
          </a>
          <a href="{{ url_for('homeowner_next_loan_paths') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/next/loan-paths') %}active{% endif %}">
            Loan Paths
          </a>
          <a href="{{ url_for('homeowner_next_affordability') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/next/affordability') %}active{% endif %}">
            Affordability
          </a>
        </div>
      </div>
      
      <div class="ylh-dropdown">
        <button type="button" class="ylh-nav-button {% if is_care %}active{% endif %}" onclick="toggleDropdown(this, event)">
          Care ▾
        </button>
        <div class="ylh-dropdown-menu">
          <a href="{{ url_for('homeowner_upload_documents') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/upload-documents') or path.startswith('/homeowner/home-timeline') %}active{% endif %}">
            Documents & Timeline
          </a>
          <a href="{{ url_for('homeowner_care_maintenance_guide') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/care/maintenance-guide') %}active{% endif %}">
            Maintenance Guide
          </a>
          <a href="{{ url_for('homeowner_care_seasonal_checklists') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/care/seasonal-checklists') %}active{% endif %}">
            Seasonal Checklists
          </a>
          <a href="{{ url_for('homeowner_care_home_protection') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/care/home-protection') %}active{% endif %}">
            Home Protection
          </a>
          <a href="{{ url_for('homeowner_care_warranty_log') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/care/warranty-log') %}active{% endif %}">
            Warranty Log
          </a>
          <a href="{{ url_for('homeowner_care_energy_savings') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/care/energy-savings') %}active{% endif %}">
            Energy Savings
          </a>
        </div>
      </div>
      
      <div class="ylh-dropdown">
        <button type="button" class="ylh-nav-button {% if is_support %}active{% endif %}" onclick="toggleDropdown(this, event)">
          Support ▾
        </button>
        <div class="ylh-dropdown-menu">
          <a href="{{ url_for('homeowner_support_ask_question') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/support/ask-question') %}active{% endif %}">
            Ask a Question
          </a>
          <a href="{{ url_for('homeowner_support_chat_human') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/support/chat-human') %}active{% endif %}">
            Chat with Human
          </a>
          <a href="{{ url_for('homeowner_support_schedule_chat') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/support/schedule-chat') %}active{% endif %}">
            Schedule Chat
          </a>
          <a href="{{ url_for('homeowner_support_resources') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/support/resources') %}active{% endif %}">
            Resources
          </a>
          <a href="{{ url_for('homeowner_support_meet_team') }}" class="ylh-dropdown-item {% if path.startswith('/homeowner/support/meet-team') %}active{% endif %}">
            Meet Team
          </a>
        </div>
      </div>
    </div>
    
    <!-- Agent/Lender Info -->
    {% if professionals %}
      {% set agent_prof = None %}
      {% set lender_prof = None %}
      {% for prof in professionals %}
        {% set is_agent = prof.get('professional_role') == 'agent' or prof.get('professional_type') == 'agent' or (prof.get('role') == 'agent' if prof.get('role') else False) %}
        {% set is_lender = prof.get('professional_role') == 'lender' or prof.get('professional_type') == 'lender' or (prof.get('role') == 'lender' if prof.get('role') else False) %}
        {% if is_agent and not agent_prof %}
          {% set agent_prof = prof %}
        {% elif is_lender and not lender_prof %}
          {% set lender_prof = prof %}
        {% endif %}
      {% endfor %}
      
      <div class="agent-info-widget">
        <!-- Agent Card -->
        {% if agent_prof %}
        <div class="agent-lender-card">
          {% set agent_photo_url = get_professional_photo_url(agent_prof.get('professional_photo')) %}
          {% if agent_photo_url %}
            <img src="{{ agent_photo_url }}" alt="{{ agent_prof.name or 'Agent' }}" class="agent-lender-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="agent-lender-photo-placeholder" style="display: none;">{{ (agent_prof.name or 'A')[0] }}</div>
          {% else %}
            <div class="agent-lender-photo-placeholder">{{ (agent_prof.name or 'A')[0] }}</div>
          {% endif %}
          <div class="agent-lender-info">
            <div class="agent-lender-label">Agent</div>
            <div class="agent-lender-name">{{ agent_prof.get('brokerage_name') or agent_prof.name or 'Your Agent' }}</div>
          </div>
        </div>
        {% endif %}
        
        <!-- Lender Card -->
        {% if lender_prof %}
        <div class="agent-lender-card">
          {% set lender_photo_url = get_professional_photo_url(lender_prof.get('professional_photo')) %}
          {% if lender_photo_url %}
            <img src="{{ lender_photo_url }}" alt="{{ lender_prof.name or 'Lender' }}" class="agent-lender-photo" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="agent-lender-photo-placeholder" style="display: none;">{{ (lender_prof.name or 'L')[0] }}</div>
          {% else %}
            <div class="agent-lender-photo-placeholder">{{ (lender_prof.name or 'L')[0] }}</div>
          {% endif %}
          <div class="agent-lender-info">
            <div class="agent-lender-label">Lender</div>
            <div class="agent-lender-name">{{ lender_prof.get('brokerage_name') or lender_prof.name or 'Your Lender' }}</div>
          </div>
        </div>
        {% endif %}
      </div>
    {% endif %}
  </div>
</nav>

<script>
// Dropdown Toggle
function toggleDropdown(btn, evt) {
  evt.stopPropagation();
  evt.preventDefault();
  
  var dropdown = btn.parentElement;
  var isOpen = dropdown.classList.contains('is-open');
  
  // Close all dropdowns
  var allDropdowns = document.querySelectorAll('.ylh-dropdown');
  for (var i = 0; i < allDropdowns.length; i++) {
    allDropdowns[i].classList.remove('is-open');
  }
  
  // Toggle this one
  if (!isOpen) {
    dropdown.classList.add('is-open');
  }
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(e) {
  var allDropdowns = document.querySelectorAll('.ylh-dropdown');
  for (var i = 0; i < allDropdowns.length; i++) {
    allDropdowns[i].classList.remove('is-open');
  }
});
</script>

<!-- Main Content Area -->
{% block homeowner_content %}{% endblock %}

{% endblock %}
