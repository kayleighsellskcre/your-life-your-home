{% extends "homeowner/layout.html" %}
{% block title %}Renovation Planner{% endblock %}

{% block homeowner_content %}
<div class="dashboard-main__header">
  <p class="dashboard-tagline">Build your vision</p>
  <h1>Renovation Planner</h1>
  <p>Capture your project ideas, budgets, and steps in one place so you can move forward without scattered notes.</p>
</div>

<div class="dashboard-section">
  <div class="card" style="background: linear-gradient(135deg, var(--light-cream) 0%, var(--soft-tan) 100%);">
    <h2>Create a New Project</h2>
    <form method="post" style="display: grid; gap: 1.5rem; max-width: 600px; margin-top: 1.5rem;">
      <div>
        <label for="project_name" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Project Name</label>
        <input id="project_name" name="project_name" placeholder="Kitchen refresh, backyard, primary bath..." required />
      </div>
      <div>
        <label for="project_budget" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Estimated Budget</label>
        <input id="project_budget" name="project_budget" placeholder="Example: 8,000" />
      </div>
      <div>
        <label for="project_status" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Status</label>
        <select id="project_status" name="project_status">
          <option>Planning</option>
          <option>In progress</option>
          <option>Completed</option>
        </select>
      </div>
      <div>
        <label for="project_notes" style="display: block; font-size: 0.9rem; font-weight: 600; color: var(--olive-green); text-transform: uppercase; letter-spacing: 0.03em; margin-bottom: 0.5rem;">Notes</label>
        <textarea id="project_notes" name="project_notes" rows="4"></textarea>
      </div>
      <button class="btn btn-primary" type="submit" style="align-self: flex-start;">Save Project</button>
    </form>
  </div>
</div>

<div class="dashboard-section">
  <h2>Your Projects</h2>
  {% if projects %}
    <div class="dashboard-cards">
      {% for project in projects %}
        <div class="card" style="position: relative; padding: 1.5rem;">
          <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
            <h3 style="margin: 0; flex: 1;">{{ project.name }}</h3>
            <div style="display: flex; gap: 0.5rem;">
              <a href="{{ url_for('homeowner_reno_planner_edit_project', project_id=project.id) }}" 
                 class="btn btn-secondary" 
                 style="padding: 0.5rem 1rem; font-size: 0.85rem; text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem;">
                ‚úèÔ∏è Edit
              </a>
              <button onclick="deleteProject({{ project.id }}, '{{ project.name|e }}')" 
                      class="btn" 
                      style="padding: 0.5rem 1rem; font-size: 0.85rem; background: #f5f5f5; border: 1px solid #ddd; color: #b3574a; cursor: pointer;">
                üóëÔ∏è Delete
              </button>
            </div>
          </div>
          <p class="card-subtext">
            Status: <strong>{{ project.status or "Planning" }}</strong>
            {% if project.budget and project.budget != '' %}
              ‚Ä¢ Budget: <strong>${{ "{:,.0f}".format(project.budget|float) if project.budget|float else project.budget }}</strong>
            {% endif %}
            {% if project.category and project.category != 'Other' %}
              ‚Ä¢ Category: <strong>{{ project.category }}</strong>
            {% endif %}
          </p>
          {% if project.notes %}
            <p class="card-subtext" style="margin-top: 0.75rem;">{{ project.notes }}</p>
          {% endif %}
          <p style="font-size: 0.85rem; color: #888; margin-top: 1rem;">
            Created: {{ project.created_at }}
          </p>
        </div>
      {% endfor %}
    </div>
    <script>
    function deleteProject(projectId, projectName) {
      if (!confirm(`Are you sure you want to delete "${projectName}"? This action cannot be undone.`)) {
        return;
      }
      
      fetch(`/homeowner/reno/planner/project/${projectId}/delete`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          location.reload();
        } else {
          alert('Could not delete project: ' + (data.error || 'Unknown error'));
        }
      })
      .catch(() => alert('Could not delete project.'));
    }
    </script>
  {% else %}
    <div class="empty-state">
      <h3>üî® No Projects Yet</h3>
      <p>Start with the one that's on your mind the most, even if it's just in the dreaming phase.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
