{% extends "homeowner/layout.html" %}
{% block title %}Dashboard Overview{% endblock %}

{% block homeowner_content %}
<style>
  /* Interactive hover animations */
  .hero-visual {
    position: relative;
    height: 100%;
    min-height: 500px;
    background: linear-gradient(135deg, #EFE9DC 0%, #D7C4A5 100%);
    overflow: hidden;
    cursor: pointer;
    transition: all 0.6s ease;
  }
  
  .hero-visual:hover {
    transform: scale(1.02);
  }
  
  .hero-visual::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(107,106,69,0.15) 0%, rgba(200,180,151,0.15) 100%);
    transition: opacity 0.6s ease;
  }
  
  .hero-visual:hover::after {
    opacity: 0.5;
  }
  
  /* Animated decorative elements */
  .leaf-decoration {
    position: absolute;
    opacity: 0.08;
    transition: all 0.8s ease;
  }
  
  .hero-visual:hover .leaf-decoration {
    opacity: 0.15;
    transform: rotate(10deg) scale(1.1);
  }
  
  /* Interactive stat cards */
  .stat-spotlight {
    background: white;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    cursor: default;
    border: 1px solid transparent;
  }
  
  .stat-spotlight::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(107,106,69,0.1), transparent);
    transition: left 0.6s ease;
  }
  
  .stat-spotlight:hover::before {
    left: 100%;
  }
  
  .stat-spotlight:hover {
    transform: translateY(-12px);
    box-shadow: 0 20px 40px rgba(58, 53, 44, 0.15);
  }
  
  .stat-value-display {
    transition: all 0.3s ease;
  }
  
  .stat-spotlight:hover .stat-value-display {
    transform: scale(1.05);
    color: #6B6A45;
  }
  
  /* Pulsing badge */
  @keyframes pulse-badge {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.9; }
  }
  
  .logo-badge {
    animation: pulse-badge 3s ease-in-out infinite;
  }
  
  /* Smooth CTA button */
  .cta-button {
    display: inline-block;
    padding: 1.1rem 3rem;
    background: #6B6A45;
    color: white;
    text-decoration: none;
    font-size: 0.9rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 500;
    position: relative;
    overflow: hidden;
  }
  
  .cta-button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
  }
  
  .cta-button:hover::before {
    width: 300px;
    height: 300px;
  }
  
  .cta-button:hover {
    background: #5A6D47;
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(107, 106, 69, 0.3);
  }
  
  /* Interactive quick steps */
  .step-card {
    background: white;
    padding: 2.5rem 2rem;
    text-align: center;
    border: 1px solid rgba(200, 180, 151, 0.3);
    transition: all 0.4s ease;
    cursor: pointer;
    position: relative;
  }
  
  .step-card::after {
    content: '‚Üí';
    position: absolute;
    bottom: 1.5rem;
    left: 50%;
    transform: translateX(-50%) translateY(10px);
    opacity: 0;
    font-size: 1.5rem;
    color: #6B6A45;
    transition: all 0.3s ease;
  }
  
  .step-card:hover {
    border-color: #6B6A45;
    transform: translateY(-8px);
    box-shadow: 0 15px 35px rgba(58, 53, 44, 0.12);
  }
  
  .step-card:hover::after {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
  
  .step-icon {
    font-size: 2.5rem;
    transition: all 0.3s ease;
    display: inline-block;
  }
  
  .step-card:hover .step-icon {
    transform: scale(1.2) rotateY(180deg);
  }
  
  /* Outline buttons with fill animation */
  .outline-btn {
    padding: 1rem 2rem;
    border: 1px solid #6B6A45;
    color: #6B6A45;
    text-decoration: none;
    font-size: 0.85rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    transition: all 0.3s ease;
    font-weight: 500;
    position: relative;
    overflow: hidden;
    z-index: 1;
  }
  
  .outline-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: #6B6A45;
    transition: left 0.4s ease;
    z-index: -1;
  }
  
  .outline-btn:hover::before {
    left: 0;
  }
  
  .outline-btn:hover {
    color: white;
  }
  
  /* Count-up animation for stats */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-in {
    animation: fadeInUp 0.8s ease forwards;
  }
  
  /* Parallax effect on scroll */
  .parallax-section {
    transition: transform 0.3s ease-out;
  }
  
  /* Interactive info tooltip */
  .info-tooltip {
    position: relative;
    display: inline-block;
    cursor: pointer;
    z-index: 50;
  }
  
  .tooltip-content {
    visibility: hidden;
    opacity: 0;
    position: absolute;
    bottom: 150%;
    left: 50%;
    transform: translateX(-50%);
    background: #3A352C;
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 4px;
    font-size: 0.8rem;
    white-space: nowrap;
    transition: all 0.3s ease;
    z-index: 1000;
    pointer-events: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }
  
  .info-tooltip:hover .tooltip-content,
  .info-tooltip.active .tooltip-content {
    visibility: visible;
    opacity: 1;
    bottom: 160%;
  }
  
  .tooltip-arrow {
    position: absolute;
    bottom: 140%;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid #3A352C;
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 999;
  }
  
  .info-tooltip:hover .tooltip-arrow,
  .info-tooltip.active .tooltip-arrow {
    opacity: 1;
  }
  
  /* Progress indicators */
  .progress-ring {
    transition: stroke-dashoffset 1s ease;
  }
  
  /* Ripple effect */
  .ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.6);
    transform: scale(0);
    animation: ripple-animation 0.6s ease-out;
  }
  
  @keyframes ripple-animation {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }
  
  /* Gentle floating animation */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  /* Subtle scale pulse */
  @keyframes scalePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }
  
  /* Gentle glow effect */
  @keyframes gentleGlow {
    0%, 100% { box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
    50% { box-shadow: 0 12px 32px rgba(107, 106, 69, 0.15); }
  }
  /* Gentle floating animation */
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  /* Subtle scale pulse */
  @keyframes scalePulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
  }
  
  /* Gentle glow effect */
  @keyframes gentleGlow {
    0%, 100% { box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
    50% { box-shadow: 0 12px 32px rgba(107, 106, 69, 0.15); }
  }
  
  /* Mobile Specific Fixes for Overview Page */
  @media (max-width: 768px) {
    .hero-visual {
      min-height: 200px !important;
      margin-bottom: 2rem !important;
    }
    
    .hero-visual > div {
      font-size: 1.5rem !important;
      padding: 2rem 1rem !important;
    }
    
    /* Welcome section */
    h1 {
      font-size: 2rem !important;
      line-height: 1.3 !important;
      margin-bottom: 1rem !important;
    }
    
    /* Financial Snapshot Grid */
    .stat-spotlight {
      margin-bottom: 1rem !important;
    }
    
    /* Buttons */
    .cta-button {
      padding: 1.25rem 2rem !important;
      font-size: 1rem !important;
      width: 100% !important;
      display: block !important;
      text-align: center !important;
    }
    
    /* Loan Info Bar */
    #overview-loan-display-bar {
      height: auto !important;
      padding: 1.5rem 1rem !important;
      flex-direction: column !important;
      gap: 1.5rem !important;
    }
    
    #overview-loan-display-bar > div:first-child {
      width: 100% !important;
      text-align: center !important;
    }
    
    #overview-loan-display-bar > div:last-child {
      width: 100% !important;
      flex-direction: column !important;
      gap: 1rem !important;
    }
    
    #overview-loan-display-bar > div:last-child > div {
      border-left: none !important;
      border-top: 2px solid #C8B497 !important;
      padding-left: 0 !important;
      padding-top: 1rem !important;
      width: 100% !important;
    }
    
    /* Form Container */
    #overview-loan-form-container {
      padding: 1.5rem 1rem !important;
    }
    
    /* Wealth Builder Section */
    div[style*="margin: 35rem"] {
      margin: 3rem -1rem 3rem !important;
      padding: 3rem 1rem !important;
    }
  }
</style>

<!-- Hero Section: Stacked Layout -->
<div style="margin-bottom: 6rem;" class="animate-in">
  <!-- Top: Interactive Lifestyle Visual -->
  <div class="hero-visual" onclick="this.style.transform='scale(1.05)'; setTimeout(() => this.style.transform='scale(1)', 200)" style="margin-bottom: 3rem; min-height: 150px;">
    <div style="position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #6B6A45; font-family: var(--font-heading); font-size: 2.5rem; text-align: center; padding: 1.5rem; z-index: 2;">
      <div style="font-weight: 400; line-height: 1.2;">Your Home ‚Ä¢ Your Sanctuary</div>
    </div>
    
    <!-- Animated decorative elements -->
    <div class="leaf-decoration" style="top: 10%; left: 5%; width: 100px; height: 100px;">
      <svg viewBox="0 0 100 100" style="width: 100%; height: 100%;">
        <ellipse cx="50" cy="30" rx="25" ry="35" fill="#6B6A45" opacity="0.3"/>
        <ellipse cx="50" cy="70" rx="20" ry="30" fill="#6B6A45" opacity="0.3"/>
      </svg>
    </div>
    <div class="leaf-decoration" style="bottom: 10%; right: 5%; width: 120px; height: 120px;">
      <svg viewBox="0 0 100 100" style="width: 100%; height: 100%;">
        <circle cx="50" cy="50" r="40" fill="#C8B497" opacity="0.3"/>
      </svg>
    </div>
  </div>
  
  <!-- Bottom: Welcome Message Block -->
  <div style="text-align: center; max-width: 900px; margin: 0 auto;">
    <h1 style="font-family: var(--font-heading); font-size: 3.5rem; line-height: 1.2; margin: 0 0 1.5rem; color: #3A352C; font-weight: 400; letter-spacing: -0.01em;">
      Welcome Home,<br/>
      <span style="color: #6B6A45; position: relative;">
        {{ snapshot.name.split()[0] if snapshot and snapshot.name else "Friend" }}
        <span style="position: absolute; bottom: -5px; left: 0; width: 100%; height: 2px; background: linear-gradient(90deg, #6B6A45, transparent);"></span>
      </span>
    </h1>
    
    <p style="font-size: 1.05rem; line-height: 2; color: #3A352C; opacity: 0.75; margin-bottom: 3rem; font-weight: 300;">
      Your personal wealth dashboard tracking value, equity, and opportunities. Every number tells your story. Every update brings clarity.
    </p>
    
    <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
      <a href="{{ cloud_cma_url }}" target="_blank" rel="noopener" class="cta-button" style="animation: fadeInUp 0.8s ease 0.5s both;">
        <span style="position: relative; z-index: 1;">Your Instant Home Estimate ‚Üí</span>
      </a>
      
      <a href="{{ url_for('homeowner_value_equity_overview') }}" class="cta-button" style="animation: fadeInUp 0.8s ease 0.6s both;">
        <span style="position: relative; z-index: 1;">Explore Your Equity ‚Üí</span>
      </a>
    </div>
  </div>
</div>

<!-- Live Stats: Interactive Spotlight Cards -->
<div style="margin-bottom: 6rem;" class="animate-in">
  <div style="text-align: center; margin-bottom: 2rem;">
    <h2 style="font-family: var(--font-heading); font-size: 2.8rem; margin-bottom: 1rem; color: #3A352C; font-weight: 400; letter-spacing: 0.01em;">
      Your Financial Snapshot
    </h2>
    <p style="font-size: 1rem; color: #6B6A45; opacity: 0.8; font-weight: 300; animation: fadeInUp 0.8s ease 0.3s both;">Live data ‚Ä¢ Updated daily ‚Ä¢ Always accurate</p>
  </div>
  
  <div style="display: grid !important; grid-template-columns: 1fr 1fr 1fr !important; gap: 0.75rem !important; width: 100% !important; grid-auto-flow: column !important;">
    <!-- Card 1: Home Value with interactive tooltip -->
    <div class="stat-spotlight" style="overflow: visible; display: flex; flex-direction: column; min-width: 0 !important; max-width: 100% !important; width: 100% !important; animation: fadeInUp 0.8s ease 0.2s both;">
      <div style="background: linear-gradient(135deg, #F6F2E8 0%, #EFE9DC 100%); padding: 1.25rem 0.875rem; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; overflow: visible; flex: 1;">
        <div class="info-tooltip" style="position: absolute; top: 0.5rem; right: 0.5rem; width: 18px; height: 18px; border: 1px solid #6B6A45; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; color: #6B6A45; cursor: pointer; transition: all 0.3s ease; background: transparent;" onmouseover="this.style.background='#6B6A45'; this.style.color='white'" onmouseout="if(!this.classList.contains('active')){this.style.background='transparent'; this.style.color='#6B6A45'}">
          i
          <span class="tooltip-content">
            {% if snapshot and snapshot.last_value_refresh %}
              Updated {{ snapshot.last_value_refresh }}
            {% else %}
              Based on recent market activity
            {% endif %}
          </span>
          <span class="tooltip-arrow"></span>
        </div>
        <div style="font-size: 0.6rem; letter-spacing: 0.1em; text-transform: uppercase; color: #6B6A45; margin-bottom: 0.5rem; font-weight: 500;">Current Value</div>
        <div class="stat-value-display" style="font-family: var(--font-heading); font-size: 1.6rem; color: #3A352C; font-weight: 400; margin-bottom: 0.35rem;">
          {% if snapshot and snapshot.value_estimate %}
            ${{ "{:,.0f}".format(snapshot.value_estimate) }}
          {% else %}
            <span style="font-size: 0.9rem; color: #6B6A45; opacity: 0.5;">Not set</span>
          {% endif %}
        </div>
        {% if snapshot and snapshot.value_estimate %}
        <div style="font-size: 0.65rem; color: #6B6A45; font-weight: 500;">
          ‚Üó +{{ ((snapshot.value_estimate - (snapshot.value_estimate * 0.95)) / (snapshot.value_estimate * 0.95) * 100) | round(1) }}% YTD
        </div>
        {% endif %}
        {% if snapshot and snapshot.last_value_refresh %}
        <div style="font-size: 0.6rem; color: #6B6A45; opacity: 0.6; margin-top: 0.35rem;">
          Updated {{ snapshot.last_value_refresh }}
        </div>
        {% endif %}
      </div>
      <div style="padding: 1rem 0.875rem;">
        <h3 style="font-family: var(--font-heading); font-size: 0.95rem; margin: 0 0 0.35rem; color: #3A352C; font-weight: 400;">Home Value</h3>
        <p style="font-size: 0.7rem; color: #6B6A45; font-weight: 400; opacity: 0.8; line-height: 1.4; margin-bottom: 0.6rem;">Real-time market estimate</p>
        <a href="{{ cloud_cma_url }}" target="_blank" style="display: inline-block; font-size: 0.7rem; color: #6B6A45; text-decoration: none; border-bottom: 1px solid #6B6A45; padding-bottom: 2px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderBottom='1px solid transparent'" onmouseout="this.style.borderBottom='1px solid #6B6A45'">
          Get detailed report ‚Üí
        </a>
      </div>
    </div>
    
    <!-- Card 2: Equity with progress visualization -->
    <div class="stat-spotlight" style="display: flex; flex-direction: column; min-width: 0 !important; max-width: 100% !important; width: 100% !important; animation: fadeInUp 0.8s ease 0.3s both;">
      <div style="background: linear-gradient(135deg, #F6F2E8 0%, #EFE9DC 100%); padding: 1.25rem 0.875rem; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; flex: 1;">
        {% if snapshot and snapshot.equity_estimate and snapshot.value_estimate %}
          {% set equity_percent = (snapshot.equity_estimate / snapshot.value_estimate * 100) | round(0) %}
          <!-- Circular progress indicator -->
          <svg style="position: absolute; top: 0.5rem; right: 0.5rem; width: 35px; height: 35px; transform: rotate(-90deg);">
            <circle cx="17.5" cy="17.5" r="14" stroke="#EFE9DC" stroke-width="2.5" fill="none"/>
            <circle class="progress-ring" cx="17.5" cy="17.5" r="14" stroke="#6B6A45" stroke-width="2.5" fill="none"
                    stroke-dasharray="87.96" 
                    stroke-dashoffset="87.96"
                    data-target-offset="{{ 87.96 - (87.96 * equity_percent / 100) }}"
                    style="transition: stroke-dashoffset 2s cubic-bezier(0.4, 0, 0.2, 1);"/>
          </svg>
          <div style="position: absolute; top: 1.1rem; right: 0.95rem; font-size: 0.55rem; color: #6B6A45; font-weight: 600;">{{ equity_percent }}%</div>
        {% endif %}
        <div style="font-size: 0.6rem; letter-spacing: 0.1em; text-transform: uppercase; color: #6B6A45; margin-bottom: 0.5rem; font-weight: 500;">Your Equity</div>
        <div class="stat-value-display" style="font-family: var(--font-heading); font-size: 1.6rem; color: #3A352C; font-weight: 400; margin-bottom: 0.35rem;">
          {% if snapshot and snapshot.equity_estimate %}
            ${{ "{:,.0f}".format(snapshot.equity_estimate) }}
          {% else %}
            <span style="font-size: 0.9rem; color: #6B6A45; opacity: 0.5;">Not set</span>
          {% endif %}
        </div>
        {% if snapshot and snapshot.equity_estimate and snapshot.value_estimate %}
        <div style="font-size: 0.65rem; color: #6B6A45; font-weight: 500;">
          {{ equity_percent }}% of home value
        </div>
        {% endif %}
      </div>
      <div style="padding: 1rem 0.875rem;">
        <h3 style="font-family: var(--font-heading); font-size: 0.95rem; margin: 0 0 0.35rem; color: #3A352C; font-weight: 400;">Equity Position</h3>
        <p style="font-size: 0.7rem; color: #6B6A45; font-weight: 400; opacity: 0.8; line-height: 1.4; margin-bottom: 0.6rem;">What you truly own</p>
        <a href="{{ url_for('homeowner_value_equity_overview') }}" style="display: inline-block; font-size: 0.7rem; color: #6B6A45; text-decoration: none; border-bottom: 1px solid #6B6A45; padding-bottom: 2px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderBottom='1px solid transparent'" onmouseout="this.style.borderBottom='1px solid #6B6A45'">
          View equity dashboard ‚Üí
        </a>
      </div>
    </div>
    
    <!-- Card 3: Loan Details -->
    <div class="stat-spotlight" style="display: flex; flex-direction: column; min-width: 0 !important; max-width: 100% !important; width: 100% !important; animation: fadeInUp 0.8s ease 0.4s both;">
      <div style="background: linear-gradient(135deg, #F6F2E8 0%, #EFE9DC 100%); padding: 1rem 0.875rem; display: flex; flex-direction: column; align-items: center; justify-content: center; flex: 1;">
        <div style="width: 100%; text-align: center;">
          <div style="margin-bottom: 0.6rem; padding-bottom: 0.4rem; border-bottom: 1px solid rgba(107,106,69,0.2);">
            <div style="font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: #6B6A45; font-weight: 500; margin-bottom: 0.25rem;">Rate</div>
            <div class="stat-value-display" style="font-family: var(--font-heading); font-size: 1.2rem; color: #3A352C; font-weight: 400;">
              {% if snapshot and snapshot.loan_rate %}{{ "{:.2f}".format(snapshot.loan_rate) }}%{% else %}<span style="font-size: 0.8rem; color: #6B6A45; opacity: 0.5;">Not set</span>{% endif %}
            </div>
          </div>
          <div style="margin-bottom: 0.6rem; padding-bottom: 0.4rem; border-bottom: 1px solid rgba(107,106,69,0.2);">
            <div style="font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: #6B6A45; font-weight: 500; margin-bottom: 0.25rem;">Monthly</div>
            <div class="stat-value-display" style="font-family: var(--font-heading); font-size: 1rem; color: #3A352C; font-weight: 400;">
              {% if snapshot and snapshot.loan_payment %}${{ "{:,.0f}".format(snapshot.loan_payment) }}{% else %}<span style="font-size: 0.8rem; color: #6B6A45; opacity: 0.5;">Not set</span>{% endif %}
            </div>
          </div>
          <div>
            <div style="font-size: 0.55rem; letter-spacing: 0.1em; text-transform: uppercase; color: #6B6A45; font-weight: 500; margin-bottom: 0.25rem;">Balance</div>
            <div class="stat-value-display" style="font-family: var(--font-heading); font-size: 0.9rem; color: #3A352C; font-weight: 400;">
              {% if snapshot and snapshot.loan_balance %}${{ "{:,.0f}".format(snapshot.loan_balance) }}{% else %}<span style="font-size: 0.8rem; color: #6B6A45; opacity: 0.5;">Not set</span>{% endif %}
            </div>
          </div>
        </div>
      </div>
      <div style="padding: 1rem 0.875rem;">
        <h3 style="font-family: var(--font-heading); font-size: 0.95rem; margin: 0 0 0.35rem; color: #3A352C; font-weight: 400;">Loan Overview</h3>
        <p style="font-size: 0.7rem; color: #6B6A45; font-weight: 400; opacity: 0.8; line-height: 1.4; margin-bottom: 0.6rem;">Current mortgage terms</p>
        <a href="{{ url_for('homeowner_next_loan_paths') }}" style="display: inline-block; font-size: 0.7rem; color: #6B6A45; text-decoration: none; border-bottom: 1px solid #6B6A45; padding-bottom: 2px; transition: all 0.3s ease; cursor: pointer;" onmouseover="this.style.borderBottom='1px solid transparent'" onmouseout="this.style.borderBottom='1px solid #6B6A45'">
          Explore loan options ‚Üí
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Update Loan Information Section -->
<div style="margin-bottom: 6rem; max-width: 1200px; margin-left: auto; margin-right: auto;">
  <div id="overview-loan-display-bar" style="background: white; border: 1px solid rgba(200, 180, 151, 0.3); border-radius: 0; padding: 1.25rem 2rem; box-shadow: 0 8px 24px rgba(0,0,0,0.08); height: 108px; display: flex; align-items: center; justify-content: space-between; gap: 3rem; animation: fadeInUp 0.8s ease 0.4s both;">
    <!-- Left: Title with Button Stacked -->
    <div style="display: flex; flex-direction: column; gap: 0.5rem; flex-shrink: 0; justify-content: center;">
      <h2 style="margin: 0; font-family: var(--font-heading); font-size: 1.3rem; color: #3A352C; font-weight: 400; white-space: nowrap;">Loan Info</h2>
      <button onclick="toggleLoanFormExpanded()" id="loan-form-toggle-btn" style="background: #6B6A45; color: white; border: none; padding: 0.5rem 1rem; border-radius: 0; font-weight: 500; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.7rem; white-space: nowrap;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(107, 106, 69, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
        ‚úèÔ∏è Quick Update
      </button>
    </div>
    
    <!-- Center: Data Display -->
    <div style="flex: 1; display: flex; align-items: center; justify-content: space-evenly; gap: 2rem;">
      {% if snapshot and (snapshot.value_estimate or snapshot.loan_balance) %}
        {% if snapshot.value_estimate %}
        <div style="text-align: center; border-left: 2px solid #6B6A45; padding-left: 1.5rem;">
          <div style="font-size: 0.65rem; color: #6B6A45; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.25rem;">Home Value</div>
          <div style="font-size: 1.4rem; font-weight: 600; color: #3A352C; font-family: var(--font-heading);">${{ "{:,.0f}".format(snapshot.value_estimate) }}</div>
        </div>
        {% endif %}
        
        {% if snapshot.loan_balance %}
        <div style="text-align: center; border-left: 2px solid #C8B497; padding-left: 1.5rem;">
          <div style="font-size: 0.65rem; color: #6B6A45; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.25rem;">Loan Balance</div>
          <div style="font-size: 1.4rem; font-weight: 600; color: #3A352C; font-family: var(--font-heading);">${{ "{:,.0f}".format(snapshot.loan_balance) }}</div>
        </div>
        {% endif %}
        
        {% if snapshot.loan_rate %}
        <div style="text-align: center; border-left: 2px solid #C8B497; padding-left: 1.5rem;">
          <div style="font-size: 0.65rem; color: #6B6A45; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.25rem;">Interest Rate</div>
          <div style="font-size: 1.4rem; font-weight: 600; color: #3A352C; font-family: var(--font-heading);">{{ "{:.2f}".format(snapshot.loan_rate) }}%</div>
        </div>
        {% endif %}
        
        {% if snapshot.loan_payment %}
        <div style="text-align: center; border-left: 2px solid #C8B497; padding-left: 1.5rem;">
          <div style="font-size: 0.65rem; color: #6B6A45; font-weight: 600; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 0.25rem;">Monthly Payment</div>
          <div style="font-size: 1.4rem; font-weight: 600; color: #3A352C; font-family: var(--font-heading);">${{ "{:,.0f}".format(snapshot.loan_payment) }}</div>
        </div>
        {% endif %}
      {% else %}
        <div style="color: #6B6A45; opacity: 0.6; font-size: 0.95rem;">
          Click "Quick Update" to add your loan information ‚Üí
        </div>
      {% endif %}
    </div>
  </div>
    
  <div id="overview-loan-form-container" style="display: none; margin-top: 1.5rem; background: white; border: 1px solid rgba(200, 180, 151, 0.3); padding: 2rem; box-shadow: 0 4px 16px rgba(0,0,0,0.06);">
      <form method="post" action="{{ url_for('homeowner_value_equity_overview') }}" style="display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));">
        <div>
          <label for="value_estimate" style="display: block; font-size: 0.75rem; font-weight: 600; color: #6B6A45; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">üí∞ Home Value</label>
          <input type="text" id="value_estimate" name="value_estimate" placeholder="e.g., 480,000" value="{% if snapshot and snapshot.value_estimate %}{{ snapshot.value_estimate|int }}{% endif %}" style="width: 100%; padding: 0.875rem; border: 2px solid rgba(200, 180, 151, 0.4); border-radius: 0; font-size: 1rem; transition: border-color 0.3s;" onfocus="this.style.borderColor='#6B6A45'" onblur="this.style.borderColor='rgba(200, 180, 151, 0.4)'" />
        </div>
        
        <div>
          <label for="loan_balance" style="display: block; font-size: 0.75rem; font-weight: 600; color: #6B6A45; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">üè¶ Loan Balance</label>
          <input type="text" id="loan_balance" name="loan_balance" placeholder="e.g., 275,000" value="{% if snapshot and snapshot.loan_balance %}{{ snapshot.loan_balance|int }}{% endif %}" style="width: 100%; padding: 0.875rem; border: 2px solid rgba(200, 180, 151, 0.4); border-radius: 0; font-size: 1rem; transition: border-color 0.3s;" onfocus="this.style.borderColor='#6B6A45'" onblur="this.style.borderColor='rgba(200, 180, 151, 0.4)'" />
        </div>
        
        <div>
          <label for="loan_rate" style="display: block; font-size: 0.75rem; font-weight: 600; color: #6B6A45; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">üìä Interest Rate (%)</label>
          <input type="text" id="loan_rate" name="loan_rate" placeholder="e.g., 3.38" value="{% if snapshot and snapshot.loan_rate %}{{ snapshot.loan_rate }}{% endif %}" style="width: 100%; padding: 0.875rem; border: 2px solid rgba(200, 180, 151, 0.4); border-radius: 0; font-size: 1rem; transition: border-color 0.3s;" onfocus="this.style.borderColor='#6B6A45'" onblur="this.style.borderColor='rgba(200, 180, 151, 0.4)'" />
        </div>
        
        <div>
          <label for="loan_payment" style="display: block; font-size: 0.75rem; font-weight: 600; color: #6B6A45; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.5rem;">üí≥ Monthly Payment</label>
          <input type="text" id="loan_payment" name="loan_payment" placeholder="e.g., 2,450" value="{% if snapshot and snapshot.loan_payment %}{{ snapshot.loan_payment|int }}{% endif %}" style="width: 100%; padding: 0.875rem; border: 2px solid rgba(200, 180, 151, 0.4); border-radius: 0; font-size: 1rem; transition: border-color 0.3s;" onfocus="this.style.borderColor='#6B6A45'" onblur="this.style.borderColor='rgba(200, 180, 151, 0.4)'" />
        </div>
        
        <div style="grid-column: 1 / -1; display: flex; gap: 1rem; margin-top: 1rem;">
          <button type="submit" style="flex: 1; padding: 1rem 2rem; background: #6B6A45; color: white; border: none; border-radius: 0; font-weight: 500; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.9rem; box-shadow: 0 4px 12px rgba(107, 106, 69, 0.3);" onmouseover="this.style.background='#5A6D47'" onmouseout="this.style.background='#6B6A45'">üíæ Save & Update</button>
          <button type="button" onclick="toggleLoanFormExpanded()" style="padding: 1rem 2rem; background: transparent; color: #6B6A45; border: 1px solid #6B6A45; border-radius: 0; font-weight: 500; cursor: pointer; transition: all 0.3s; text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.9rem;" onmouseover="this.style.background='#F6F2E8'" onmouseout="this.style.background='transparent'">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
function toggleLoanFormExpanded() {
  const form = document.getElementById('overview-loan-form-container');
  const displayBar = document.getElementById('overview-loan-display-bar');
  const btn = document.getElementById('loan-form-toggle-btn');
  
  if (!form || !displayBar || !btn) return;
  
  if (form.style.display === 'none') {
    form.style.display = 'block';
    displayBar.style.opacity = '0.5';
    btn.textContent = '‚úñÔ∏è Close';
    btn.style.background = '#C8B497';
  } else {
    form.style.display = 'none';
    displayBar.style.opacity = '1';
    btn.textContent = '‚úèÔ∏è Quick Update';
    btn.style.background = '#6B6A45';
  }
}
</script>

<!-- Wealth Builder Section: Stacked Layout -->
<div style="background: #F6F2E8; margin: 35rem -4rem 6rem; padding: 6rem 4rem;" class="parallax-section">
  <div style="max-width: 1200px; margin: 0 auto;">
    <!-- Top: Visual -->
    <div style="margin-bottom: 4rem;">
      <div style="position: relative; min-height: 150px; background: linear-gradient(135deg, #EFE9DC 0%, #D7C4A5 100%); display: flex; align-items: center; justify-content: center; color: #6B6A45; font-family: var(--font-heading); font-size: 1.8rem; text-align: center; padding: 1.5rem; overflow: hidden;">
        <div style="position: relative; z-index: 2;">
          Your Home ‚Ä¢ Your Legacy
        </div>
        <!-- Animated background shapes -->
        <div style="position: absolute; top: 10%; right: 10%; width: 100px; height: 100px; border: 2px solid rgba(107,106,69,0.2); border-radius: 50%; animation: pulse-badge 4s ease-in-out infinite;"></div>
        <div style="position: absolute; bottom: 15%; left: 15%; width: 80px; height: 80px; border: 2px solid rgba(107,106,69,0.2); animation: pulse-badge 3s ease-in-out infinite; animation-delay: 1s;"></div>
      </div>
    </div>
    
    <!-- Bottom: Text Content -->
    <div style="text-align: center; max-width: 900px; margin: 0 auto;">
      <div style="display: inline-block; padding: 0.4rem 1rem; background: white; border: 1px solid #6B6A45; margin-bottom: 2rem; font-size: 0.7rem; letter-spacing: 0.15em; text-transform: uppercase; color: #6B6A45; font-weight: 500;">
        Your Wealth Journey
      </div>
      <h2 style="font-family: var(--font-heading); font-size: 3.5rem; line-height: 1.25; margin: 0 0 2rem; color: #3A352C; font-weight: 400;">
        Every Month,<br/>
        Your Wealth Grows
      </h2>
      <p style="font-size: 1.15rem; line-height: 2; color: #3A352C; opacity: 0.75; font-weight: 300; margin-bottom: 1rem;">
        {% if snapshot and snapshot.loan_payment and snapshot.loan_balance and snapshot.loan_rate %}
          {% set monthly_principal = (snapshot.loan_payment - (snapshot.loan_balance * snapshot.loan_rate / 100 / 12)) %}
          Every payment adds <strong style="color: #6B6A45; font-weight: 500;">${{ "{:,.0f}".format(monthly_principal) }}</strong> to your equity.
        {% else %}
          Every payment builds your equity. Every improvement adds value.
        {% endif %}
        Every decision shapes your future.
      </p>
      <p style="font-size: 1.05rem; line-height: 2; color: #3A352C; opacity: 0.7; font-weight: 300; margin-bottom: 2rem;">
        We're here to help you see the full picture and make choices that feel right for your life.
      </p>
    </div>
    
    <!-- Recommended Next Steps - Integrated -->
    <div style="margin-top: 3rem;">
      <div style="text-align: center; margin-bottom: 3rem;">
        <h2 style="font-family: var(--font-heading); font-size: 2.8rem; margin-bottom: 1rem; color: #3A352C; font-weight: 400; letter-spacing: 0.01em;">
          Recommended Next Steps
        </h2>
        <p style="font-size: 1rem; color: #6B6A45; opacity: 0.8; font-weight: 300;">Click to explore ‚Ä¢ Each step takes less than 5 minutes</p>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2.5rem;">
        <a href="{{ url_for('homeowner_value_equity_overview') }}" class="step-card" style="text-decoration: none; color: inherit;">
          <div class="step-icon">üìä</div>
          <h3 style="font-family: var(--font-heading); font-size: 1.4rem; margin: 1.5rem 0 1rem; color: #3A352C; font-weight: 400;">Update Your Numbers</h3>
          <p style="font-size: 0.95rem; line-height: 1.9; color: #3A352C; opacity: 0.7; font-weight: 300; margin-bottom: 2rem;">Refresh loan details for accurate equity tracking</p>
        </a>
        
        <a href="{{ url_for('homeowner_reno_planner') }}" class="step-card" style="text-decoration: none; color: inherit;">
          <div class="step-icon">üî®</div>
          <h3 style="font-family: var(--font-heading); font-size: 1.4rem; margin: 1.5rem 0 1rem; color: #3A352C; font-weight: 400;">Plan Renovations</h3>
          <p style="font-size: 0.95rem; line-height: 1.9; color: #3A352C; opacity: 0.7; font-weight: 300; margin-bottom: 2rem;">Track ideas, costs, and ROI for home improvements</p>
        </a>
        
        <a href="{{ url_for('homeowner_next_plan_move') }}" class="step-card" style="text-decoration: none; color: inherit;">
          <div class="step-icon">üè°</div>
          <h3 style="font-family: var(--font-heading); font-size: 1.4rem; margin: 1.5rem 0 1rem; color: #3A352C; font-weight: 400;">Explore Moving</h3>
          <p style="font-size: 0.95rem; line-height: 1.9; color: #3A352C; opacity: 0.7; font-weight: 300; margin-bottom: 2rem;">See timing, affordability, and next home options</p>
        </a>
      </div>
    </div>
  </div>
</div>

<script>
// Advanced count-up animation for all stat values
document.addEventListener('DOMContentLoaded', function() {
  // Animate all stat values on page load
  const statValues = document.querySelectorAll('.stat-value-display');
  
  statValues.forEach(stat => {
    const text = stat.textContent.trim();
    
    // Skip empty values and placeholder text
    if (text === '‚Äî' || text === '' || text.includes('Not set')) return;
    
    // Handle currency values
    if (text.includes('$')) {
      const value = parseFloat(text.replace(/[$,]/g, ''));
      if (!isNaN(value) && value > 0) {
        stat.setAttribute('data-target', value);
        animateValue(stat, 0, value, 2000, 'currency');
      }
    }
    // Handle percentages
    else if (text.includes('%')) {
      const value = parseFloat(text.replace(/%/g, ''));
      if (!isNaN(value) && value > 0) {
        stat.setAttribute('data-target', value);
        animateValue(stat, 0, value, 1800, 'percent');
      }
    }
  });
  
  function animateValue(element, start, end, duration, type) {
    const startTime = performance.now();
    
    function update(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      // Smooth easing function
      const easeOutCubic = 1 - Math.pow(1 - progress, 3);
      const current = start + (end - start) * easeOutCubic;
      
      if (type === 'currency') {
        element.textContent = '$' + Math.floor(current).toLocaleString();
      } else if (type === 'percent') {
        element.textContent = current.toFixed(2) + '%';
      }
      
      if (progress < 1) {
        requestAnimationFrame(update);
      } else {
        // Ensure final value is exact
        if (type === 'currency') {
          element.textContent = '$' + Math.floor(end).toLocaleString();
        } else if (type === 'percent') {
          element.textContent = end.toFixed(2) + '%';
        }
      }
    }
    
    requestAnimationFrame(update);
  }
  
  // Animate progress rings
  const progressRings = document.querySelectorAll('.progress-ring');
  progressRings.forEach(ring => {
    // Trigger animation after a short delay
    setTimeout(() => {
      const targetOffset = ring.getAttribute('data-target-offset');
      if (targetOffset) {
        ring.style.strokeDashoffset = targetOffset;
      }
    }, 300);
  });
  
  // Parallax effect on scroll (optimized)
  let ticking = false;
  
  window.addEventListener('scroll', function() {
    if (!ticking) {
      window.requestAnimationFrame(function() {
        const parallaxSections = document.querySelectorAll('.parallax-section');
        const scrolled = window.pageYOffset;
        
        parallaxSections.forEach(section => {
          const speed = 0.5;
          const yPos = -(scrolled * speed);
          section.style.transform = `translateY(${yPos}px)`;
        });
        
        ticking = false;
      });
      
      ticking = true;
    }
  });
  
  // Enhanced ripple effect on stat cards (removed - cards are not clickable)
  const statCards = document.querySelectorAll('.stat-spotlight');
  
  statCards.forEach(card => {
    // Add subtle hover feedback
    card.addEventListener('mouseenter', function() {
      this.style.borderColor = 'rgba(107, 106, 69, 0.3)';
    });
    
    card.addEventListener('mouseleave', function() {
      this.style.borderColor = 'transparent';
    });
  });
  
  // Smooth scroll for internal links
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      if (href !== '#') {
        e.preventDefault();
        const target = document.querySelector(href);
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      }
    });
  });
  
  // Add intersection observer for fade-in animations
  const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
  };
  
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('animate-in');
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);
  
  // Observe all sections
  document.querySelectorAll('.stat-spotlight, .step-card').forEach(el => {
    observer.observe(el);
  });
  
  // Add click handler for info tooltips (for mobile/tablet)
  document.querySelectorAll('.info-tooltip').forEach(tooltip => {
    tooltip.addEventListener('click', function(e) {
      e.stopPropagation();
      
      // Close other tooltips
      document.querySelectorAll('.info-tooltip.active').forEach(other => {
        if (other !== this) {
          other.classList.remove('active');
        }
      });
      
      // Toggle this tooltip
      this.classList.toggle('active');
    });
  });
  
  // Close tooltip when clicking outside
  document.addEventListener('click', function() {
    document.querySelectorAll('.info-tooltip.active').forEach(tooltip => {
      tooltip.classList.remove('active');
    });
  });
});
</script>

{% endblock %}
