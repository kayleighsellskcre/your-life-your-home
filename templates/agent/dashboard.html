{% extends "agent/layout.html" %}

{% block agent_content %}
<style>
  @media (max-width: 768px) and (orientation: portrait) {
    .dashboard-main__header {
      padding: 0.625rem 0.875rem !important;
      margin-bottom: 0.875rem !important;
      border-bottom: 1px solid rgba(107, 106, 69, 0.1) !important;
    }
    
    .dashboard-main__header .dashboard-tagline {
      font-size: 0.65rem !important;
      margin-bottom: 0.25rem !important;
      color: #6B6A45 !important;
      text-transform: uppercase !important;
      letter-spacing: 0.1em !important;
      font-weight: 600 !important;
    }
    
    .dashboard-main__header h1 {
      font-size: 1.15rem !important;
      margin: 0 0 0.3125rem 0 !important;
      line-height: 1.3 !important;
      font-weight: 600 !important;
    }
    
    .dashboard-main__header p {
      font-size: 0.8rem !important;
      margin: 0 !important;
      line-height: 1.5 !important;
      color: rgba(58, 53, 44, 0.7) !important;
    }
    
    .dashboard-section {
      margin-top: 0.5rem !important;
    }
    
    .dashboard-cards {
      gap: 0.75rem !important;
      margin-top: 0.5rem !important;
    }
    
    .card {
      padding: 1rem 0.875rem !important;
      margin: 0 !important;
    }
    
    .card h3 {
      font-size: 0.85rem !important;
      margin-bottom: 0.5rem !important;
    }
    
    .card-value {
      font-size: 1.5rem !important;
    }
    
    .card-subtext {
      font-size: 0.75rem !important;
    }
  }
</style>

<div class="dashboard-main__header animate-in">
  <p class="dashboard-tagline">Your command center</p>
  <h1>Agent Dashboard</h1>
  <p>A clear view of your leads, transactions, and follow-ups at a glance.</p>
</div>

<div class="dashboard-section">
  <!-- Metrics Cards -->
  <div class="dashboard-cards">
    <div class="card animate-in-delay-1" style="background: linear-gradient(135deg, var(--light-cream) 0%, var(--soft-tan) 100%);">
      <h3>New Leads</h3>
      <div class="card-value">{{ metrics.new_leads|default(0) }}</div>
      <p class="card-subtext">Waiting for first contact</p>
    </div>

    <div class="card animate-in-delay-2" style="background: linear-gradient(135deg, var(--light-cream) 0%, var(--soft-tan) 100%);">
      <h3>Active Transactions</h3>
      <div class="card-value">{{ transactions|length if transactions else 0 }}</div>
      <p class="card-subtext">Files in progress</p>
    </div>

    <div class="card animate-in-delay-3" style="background: linear-gradient(135deg, var(--light-cream) 0%, var(--soft-tan) 100%);">
      <h3>Follow-ups Today</h3>
      <div class="card-value">{{ metrics.followups_today|default(0) }}</div>
      <p class="card-subtext">Clients to check in with</p>
    </div>
  </div>

  <!-- Recent Transactions Pipeline -->
  {% if transactions %}
  <div class="card" style="margin-top: 2rem;">
    <h2>Recent Transactions</h2>
    <div style="margin-top: 1rem;">
      {% for tx in transactions[:5] %}
      <a href="{{ url_for('agent_transaction_detail', tx_id=tx.id) }}" style="display: block; padding: 1rem; margin-bottom: 0.5rem; background: var(--warm-cream); border-radius: var(--border-radius); text-decoration: none; color: var(--charcoal-brown); transition: all 0.2s;" onmouseover="this.style.background='var(--light-cream)'; this.style.transform='translateX(4px)';" onmouseout="this.style.background='var(--warm-cream)'; this.style.transform='';">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <div style="font-weight: 600;">{{ tx.property_address or 'Property' }}</div>
            <div style="font-size: 0.85rem; color: #666; margin-top: 0.25rem;">{{ tx.client_name }} • {{ tx.current_stage|replace('_', ' ')|title if tx.current_stage else 'New' }}</div>
          </div>
          <span style="color: var(--olive-green);">→</span>
        </div>
      </a>
      {% endfor %}
    </div>
    <div style="margin-top: 1rem;">
      <a href="{{ url_for('agent_transactions') }}" class="btn-outline">View All Transactions</a>
    </div>
  </div>
  {% endif %}

  <!-- Quick Actions -->
  <div class="card" style="margin-top: 2rem;">
    <h2>Quick Actions</h2>
    <div style="display: grid; gap: 1rem; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); margin-top: 1.5rem;">
      <a href="{{ url_for('agent_crm') }}" class="action-card" style="display: flex; align-items: center; gap: 1rem; padding: 1.25rem; background: var(--light-cream); border-radius: var(--border-radius); text-decoration: none; color: var(--charcoal-brown); transition: all 0.25s ease;">
        <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--olive-green) 0%, var(--olive-green-dark) 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.25rem; flex-shrink: 0;">+</div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Add New Contact</div>
          <div style="font-size: 0.85rem; color: #666;">Quickly add a lead to your CRM</div>
        </div>
      </a>

      <a href="{{ url_for('agent_transactions') }}" class="action-card" style="display: flex; align-items: center; gap: 1rem; padding: 1.25rem; background: var(--light-cream); border-radius: var(--border-radius); text-decoration: none; color: var(--charcoal-brown); transition: all 0.25s ease;">
        <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--olive-green) 0%, var(--olive-green-dark) 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.25rem; flex-shrink: 0;">TX</div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Add Transaction</div>
          <div style="font-size: 0.85rem; color: #666;">Start tracking a new deal</div>
        </div>
      </a>

      <a href="{{ url_for('agent_communications') }}" class="action-card" style="display: flex; align-items: center; gap: 1rem; padding: 1.25rem; background: var(--light-cream); border-radius: var(--border-radius); text-decoration: none; color: var(--charcoal-brown); transition: all 0.25s ease;">
        <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--olive-green) 0%, var(--olive-green-dark) 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.25rem; flex-shrink: 0;">@</div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Send Template</div>
          <div style="font-size: 0.85rem; color: #666;">Use a saved email or text</div>
        </div>
      </a>

      <a href="{{ url_for('agent_marketing') }}" class="action-card" style="display: flex; align-items: center; gap: 1rem; padding: 1.25rem; background: var(--light-cream); border-radius: var(--border-radius); text-decoration: none; color: var(--charcoal-brown); transition: all 0.25s ease;">
        <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, var(--olive-green) 0%, var(--olive-green-dark) 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.25rem; flex-shrink: 0;">✎</div>
        <div>
          <div style="font-weight: 600; margin-bottom: 0.25rem;">Create Marketing</div>
          <div style="font-size: 0.85rem; color: #666;">Generate social media posts</div>
        </div>
      </a>
    </div>
  </div>
</div>
{% endblock %}
