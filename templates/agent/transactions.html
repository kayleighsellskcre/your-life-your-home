{% extends "agent/layout.html" %}

{% block agent_content %}
<style>
  .transactions-container {
    max-width: 1600px;
    margin: 0 auto;
  }

  .transaction-card {
    background: var(--white);
    border: 2px solid var(--taupe-beige);
    border-radius: var(--border-radius-lg);
    padding: 2rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-premium);
  }
  
  .transaction-card::after {
    content: '→';
    position: absolute;
    top: 50%;
    right: 2rem;
    transform: translateY(-50%);
    font-size: 1.5rem;
    color: var(--olive-green);
    opacity: 0;
    transition: all 0.3s ease;
    font-weight: bold;
  }

  .transaction-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--taupe-beige);
    transition: all 0.3s ease;
  }

  .transaction-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-premium-hover);
    border-color: var(--olive-green);
  }

  .transaction-card:hover::before {
    background: var(--olive-green);
    width: 6px;
  }
  
  .transaction-card:hover::after {
    opacity: 1;
    transform: translateY(-50%) translateX(5px);
  }

  .transaction-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
    gap: 1.5rem;
  }

  .transaction-main-info {
    flex: 1;
    min-width: 0;
  }

  .transaction-property {
    font-size: 1.3rem;
    font-weight: 600;
    color: var(--charcoal-brown);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .transaction-client {
    font-size: 1rem;
    color: #666;
    margin-bottom: 0.75rem;
  }

  .transaction-badges {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .status-badge {
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }

  .status-badge.summary { background: var(--light-cream); color: var(--charcoal-brown); }
  .status-badge.showings { background: #E3F2FD; color: #1565C0; }
  .status-badge.under_contract { background: #FFF3E0; color: #E65100; }
  .status-badge.earnest_money { background: #F3E5F5; color: #6A1B9A; }
  .status-badge.inspection { background: #E8F5E9; color: #2E7D32; }
  .status-badge.appraisal { background: #E0F2F1; color: #00695C; }
  .status-badge.loan_commitment { background: #E1F5FE; color: #0277BD; }
  .status-badge.final_walkthrough { background: #FFF9C4; color: #F57F17; }
  .status-badge.closing { background: #C8E6C9; color: #1B5E20; }

  .side-badge {
    padding: 0.4rem 0.9rem;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: 600;
    background: var(--taupe-beige);
    color: var(--charcoal-brown);
  }

  .side-badge.buyer { background: #E3F2FD; color: #1565C0; }
  .side-badge.seller { background: #FFE0B2; color: #E65100; }
  .side-badge.both { background: #F3E5F5; color: #6A1B9A; }

  .transaction-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid var(--taupe-beige);
  }

  .detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .detail-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #999;
    font-weight: 600;
  }

  .detail-value {
    font-size: 1rem;
    color: var(--charcoal-brown);
    font-weight: 500;
  }

  .transaction-actions {
    display: flex;
    gap: 0.75rem;
    align-items: flex-start;
  }

  .action-btn-small {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: var(--border-radius);
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
  }

  .action-btn-small.delete {
    background: rgba(192, 57, 43, 0.1);
    color: #c0392b;
    border: 1px solid #c0392b;
  }

  .action-btn-small.delete:hover {
    background: #c0392b;
    color: white;
    transform: translateY(-2px);
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: linear-gradient(135deg, #FFFFFF 0%, #F6F2E8 100%);
    border-radius: var(--border-radius-lg);
    border: 2px dashed var(--taupe-beige);
    box-shadow: var(--shadow-premium);
    max-width: 600px;
    margin: 0 auto;
  }

  .empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.6;
    filter: grayscale(0.3);
  }

  .empty-state h3 {
    color: var(--charcoal-brown);
    margin-bottom: 0.75rem;
    font-family: var(--font-heading);
    font-size: 1.5rem;
  }

  .empty-state p {
    color: rgba(58, 53, 44, 0.7);
    max-width: 500px;
    margin: 0 auto;
    font-size: 1rem;
    line-height: 1.6;
  }
</style>

<!-- Premium Header -->
<div class="premium-header animate-in" style="margin-bottom: 3rem; display: block !important; text-align: center !important; justify-content: center !important;">
  <div style="text-align: center; width: 100%;">
    <h1 style="font-size: 3rem; margin-bottom: 0.5rem; letter-spacing: -0.02em; text-align: center; font-family: var(--font-heading); color: var(--charcoal-brown);">AI Transaction Coordinator</h1>
    <span class="tagline" style="font-size: 1.15rem; font-style: italic; color: var(--olive-green); display: block; text-align: center;">Track every deal with ease — All your files, stages, and clients in one beautiful, interactive dashboard</span>
  </div>
</div>

<div class="transactions-container">
  <!-- Premium Add Transaction Form -->
  <div class="card-premium animate-in" style="animation-delay: 0.1s; padding: 3rem; margin-bottom: 3rem; background: linear-gradient(135deg, #FFFFFF 0%, #F6F2E8 100%); border: 1px solid var(--taupe-beige); max-width: 800px; margin-left: auto; margin-right: auto;">
    <div style="text-align: center; margin-bottom: 2.5rem;">
      <h2 style="font-family: var(--font-heading); font-size: 2.25rem; color: var(--charcoal-brown); margin-bottom: 0.5rem; position: relative; padding-bottom: 1rem;">
        <span style="display: inline-block; position: relative;">
          Add a Transaction
          <span style="position: absolute; bottom: -0.5rem; left: 50%; transform: translateX(-50%); width: 80px; height: 3px; background: var(--gradient-olive); border-radius: 2px;"></span>
        </span>
      </h2>
    </div>
    
    <form method="post" class="transaction-form-premium">
      <div class="premium-form-grid">
        <div class="premium-form-group">
          <label for="property_address" class="premium-form-label">
            <span>Property Address</span>
          </label>
          <input 
            id="property_address" 
            name="property_address" 
            type="text"
            required 
            placeholder="123 Main St, City, State" 
            class="premium-input"
          />
        </div>
        
        <div class="premium-form-group">
          <label for="client_name" class="premium-form-label">
            <span>Client Name</span>
          </label>
          <input 
            id="client_name" 
            name="client_name" 
            type="text"
            required 
            placeholder="Jane Doe" 
            class="premium-input"
          />
        </div>
        
        <div class="premium-form-group">
          <label for="side" class="premium-form-label">
            <span>Side</span>
          </label>
          <select id="side" name="side" class="premium-select">
            <option value="buyer">Buyer</option>
            <option value="seller">Seller</option>
            <option value="both">Both</option>
          </select>
        </div>
        
        <div class="premium-form-group">
          <label for="stage" class="premium-form-label">
            <span>Stage</span>
          </label>
          <select id="stage" name="stage" class="premium-select">
            <option value="summary">Summary</option>
            <option value="showings">Showings</option>
            <option value="under_contract">Under Contract</option>
            <option value="earnest_money">Earnest Money</option>
            <option value="inspection">Inspection</option>
            <option value="appraisal">Appraisal</option>
            <option value="loan_commitment">Loan Commitment</option>
            <option value="final_walkthrough">Final Walkthrough</option>
            <option value="closing">Closing</option>
          </select>
        </div>
        
        <div class="premium-form-group premium-form-full">
          <label for="close_date" class="premium-form-label">
            <span>Target Close Date <span style="font-weight: normal; font-size: 0.85em; color: rgba(58, 53, 44, 0.6); font-style: italic;">(Optional - can be added later)</span></span>
          </label>
          <input 
            type="date" 
            id="close_date" 
            name="close_date" 
            class="premium-input"
          />
        </div>
      </div>
      
      <button class="btn-premium" type="submit" style="margin-top: 2rem; width: 100%; padding: 1.25rem 2rem; font-size: 1.1rem; justify-content: center; background: var(--gradient-olive);">
        Start Transaction
      </button>
    </form>
  </div>

  <!-- Transactions List -->
  {% if transactions %}
    <div style="max-width: 1600px; margin: 0 auto;">
      <h2 style="margin-bottom: 2rem; font-family: var(--font-heading); color: var(--charcoal-brown); font-size: 2rem; text-align: center; position: relative; padding-bottom: 1rem;">
        <span style="display: inline-block; position: relative;">
          Your Transactions
          <span style="position: absolute; bottom: -0.5rem; left: 50%; transform: translateX(-50%); width: 100px; height: 3px; background: var(--gradient-olive); border-radius: 2px;"></span>
        </span>
      </h2>
    
    {% for tx in transactions %}
      <div class="transaction-card" onclick="window.location.href='{{ url_for('agent_transaction_detail', tx_id=tx.id) }}'" title="Click to open AI Transaction Coordinator">
        <div class="transaction-header">
          <div class="transaction-main-info">
            <div class="transaction-property">
              <span>{{ tx.property_address }}</span>
            </div>
            <div class="transaction-client">
              <strong>Client:</strong> {{ tx.client_name }}
            </div>
            <div class="transaction-badges">
              <span class="status-badge {{ tx.current_stage or 'summary' }}">
                {{ (tx.current_stage or 'summary')|replace('_',' ')|title }}
              </span>
              <span class="side-badge {{ tx.side or 'buyer' }}">
                {{ (tx.side or 'buyer')|capitalize }}
              </span>
            </div>
            <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--taupe-beige); font-size: 0.85rem; color: var(--olive-green); font-weight: 600;">
              Click anywhere on this card to access the full AI Transaction Coordinator
            </div>
          </div>
          <div class="transaction-actions" onclick="event.stopPropagation();">
            <form method="POST" action="{{ url_for('agent_transaction_delete', tx_id=tx.id) }}" style="display: inline;">
              <button type="submit" class="action-btn-small delete" onclick="return confirm('Delete this transaction? This cannot be undone.')">
                Delete
              </button>
            </form>
          </div>
        </div>
        
        <div class="transaction-details">
          <div class="detail-item">
            <span class="detail-label">Close Date</span>
            <span class="detail-value">{{ tx.target_close_date or 'Not set' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Created</span>
            <span class="detail-value">{{ tx.created_at[:10] if tx.created_at else '—' }}</span>
          </div>
        </div>
      </div>
    {% endfor %}
    </div>
  {% else %}
    <div class="empty-state animate-in" style="animation-delay: 0.2s;">
      <h3 style="font-family: var(--font-heading);">No Transactions Yet</h3>
      <p>Once you add a transaction, you will be able to track stages here.</p>
    </div>
  {% endif %}
</div>

<style>
/* Premium Form Styling */
.transaction-form-premium {
  width: 100%;
}

.premium-form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1.5rem;
  margin-bottom: 1rem;
}

.premium-form-group {
  display: flex;
  flex-direction: column;
}

.premium-form-full {
  grid-column: 1 / -1;
}

.premium-form-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
  font-weight: 600;
  color: var(--olive-green);
  font-size: 0.95rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}


.premium-input,
.premium-select {
  width: 100%;
  padding: 1rem 1.25rem;
  border: 2px solid var(--taupe-beige);
  border-radius: 8px;
  font-family: var(--font-body);
  font-size: 1rem;
  color: var(--charcoal-brown);
  background: var(--white);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 2px 8px rgba(58, 53, 44, 0.05);
}

.premium-input:hover,
.premium-select:hover {
  border-color: var(--olive-green);
  box-shadow: 0 4px 12px rgba(107, 106, 69, 0.1);
}

.premium-input:focus,
.premium-select:focus {
  outline: none;
  border-color: var(--olive-green);
  box-shadow: 0 0 0 3px rgba(107, 106, 69, 0.15), 0 4px 16px rgba(58, 53, 44, 0.1);
  transform: translateY(-1px);
}

.premium-select {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%233A352C' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 1rem center;
  padding-right: 2.5rem;
}

.premium-input::placeholder {
  color: rgba(58, 53, 44, 0.4);
  font-style: italic;
}

/* Premium Button Styling */
.btn-premium {
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem 2rem;
  border: none;
  border-radius: 8px;
  font-family: var(--font-body);
  font-weight: 600;
  font-size: 1rem;
  color: var(--white);
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 16px rgba(58, 53, 44, 0.15);
  text-decoration: none;
}

.btn-premium:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(58, 53, 44, 0.2);
}

.btn-premium:active {
  transform: translateY(0);
  box-shadow: 0 2px 8px rgba(58, 53, 44, 0.15);
}


/* Animations */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-in {
  animation: fadeInUp 0.6s ease-out forwards;
}

/* Responsive Design */
@media (max-width: 768px) {
  .premium-form-grid {
    grid-template-columns: 1fr;
  }
  
  .premium-header h1 {
    font-size: 2rem !important;
  }
  
  .card-premium {
    padding: 2rem 1.5rem !important;
  }
}
</style>

{% endblock %}
